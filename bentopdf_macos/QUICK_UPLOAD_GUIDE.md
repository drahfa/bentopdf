# Quick Upload Guide - SitiPDF 1.4.1

## Issue Resolved
✅ ITMS-90291: Malformed Framework - **FIXED**
✅ Missing dSYM for objective_c framework - **FIXED**

## Build Scripts Added
Two automated scripts now run during Xcode archiving:
1. **Fix Framework Structures** - Ensures proper framework bundle structure
2. **Create objective_c dSYM** - Generates required debug symbol file

## Upload Steps

### Step 1: Clean Build
```bash
cd /Users/drahfa/GitHub/bentopdf/bentopdf_macos
flutter clean
flutter pub get
```

### Step 2: Archive in Xcode (CRITICAL)

⚠️ **MUST use Xcode archive, not flutter build**

```bash
open macos/Runner.xcworkspace
```

In Xcode:
1. Select: **Any Mac (Apple Silicon, Intel)**
2. Menu: **Product > Archive**
3. Wait for completion (build scripts will run automatically)

### Step 3: Validate
1. Organizer opens automatically
2. Click **Distribute App**
3. Select **App Store Connect**
4. Click **Validate App**
5. Wait for validation

Expected: ✅ Validation completes WITHOUT errors

### Step 4: Upload
1. Click **Distribute App** again
2. Select **App Store Connect**
3. Select **Upload**
4. Complete upload

Expected: ✅ "Upload Symbols Succeeded"

### Step 5: Submit in App Store Connect
1. Go to https://appstoreconnect.apple.com
2. Select SitiPDF
3. Choose version 1.4.1
4. Add promotional text from `APP_STORE_DESCRIPTION.md`
5. Select build 6
6. Submit for review

## Verification Checklist

Before uploading, verify build scripts ran:

In Xcode build log (View > Navigators > Report Navigator):
- [ ] "Fixing framework structures" appears
- [ ] "Creating dSYM for objective_c framework" appears
- [ ] "✓ Created dSYM" appears
- [ ] "✓ UUIDs match" appears

## Expected Results

| Check | Status |
|-------|--------|
| Framework structure | ✅ Fixed by build script |
| LSApplicationCategoryType | ✅ Added to Info.plist |
| objective_c dSYM UUIDs | ✅ Generated by build script |
| All other dSYMs | ✅ Already present |
| Version number | ✅ 1.4.1 (build 6) |

## If Upload Still Fails

1. Check `DSYM_FIX_INSTRUCTIONS.md` for detailed troubleshooting
2. Verify build scripts in Xcode project (Runner target > Build Phases)
3. Manually verify archive contents:
   ```bash
   ls -la ~/Library/Developer/Xcode/Archives/*/SitiPDF*.xcarchive/dSYMs/
   ```
   Should show `objective_c.framework.dSYM`

## Support Files

- `APP_STORE_DESCRIPTION.md` - Promotional text for App Store listing
- `DSYM_FIX_INSTRUCTIONS.md` - Detailed dSYM fix documentation
- `APP_STORE_SUBMISSION_FIX.md` - Complete fix history
- `macos/create_objective_c_dsym.sh` - dSYM generation script (auto-runs)
- `macos/fix_frameworks.sh` - Framework structure fix (auto-runs)

## Quick Command Reference

```bash
# Clean
flutter clean && flutter pub get

# Archive (use Xcode, not this)
# DON'T USE: flutter build macos --release

# Open Xcode for archiving
open macos/Runner.xcworkspace

# Verify scripts exist and are executable
ls -l macos/*.sh

# Re-add build phases if needed
python3 add_build_phase.py
python3 add_dsym_build_phase.py
```

## Timeline

- **Jan 26**: Initial upload → ITMS-90291 error
- **Jan 27**: Fixed framework structure, added dSYM generation
- **Status**: Ready for re-upload

---

**Version**: 1.4.1 (build 6)
**Ready**: YES
**Action**: Archive in Xcode → Validate → Upload
